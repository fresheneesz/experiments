// Generated by CoffeeScript 1.6.3
var ModuleGeneratorTemplates, Template, l, pathRelative, _, _B,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

_ = require('lodash');

_B = require('uberscore');

l = new _B.Logger('urequire/ModuleGeneratorTemplates');

pathRelative = require('../paths/pathRelative');

Template = require('./Template');

module.exports = ModuleGeneratorTemplates = (function(_super) {
  var _this = this;

  __extends(ModuleGeneratorTemplates, _super);

  Function.prototype.property = function(p) {
    var d, n;
    for (n in p) {
      d = p[n];
      Object.defineProperty(this.prototype, n, d);
    }
    return null;
  };

  Function.prototype.staticProperty = function(p) {
    var d, n;
    for (n in p) {
      d = p[n];
      Object.defineProperty(ModuleGeneratorTemplates.prototype, n, d);
    }
    return null;
  };

  /*
    @param @ti the templateInfo (the module in ModuleGeneratorTemplates)
  */


  function ModuleGeneratorTemplates(ti) {
    this.ti = ti;
  }

  ModuleGeneratorTemplates.property({
    header: {
      get: function() {
        return "// Generated by uRequire v" + l.VERSION + "\n";
      }
    },
    moduleNamePrint: {
      get: function() {
        if (this.ti.moduleName) {
          return "'" + this.ti.moduleName + "', ";
        } else {
          return "";
        }
      }
    },
    /* @property parameters of the factory method, eg 'require, _, personModel'*/

    parametersPrint: {
      get: function() {
        var par;
        return "require" + (this.ti.moduleType === 'nodejs' ? ', exports, module' : '') + (((function() {
          var _i, _len, _ref, _results;
          _ref = this.ti.parameters;
          _results = [];
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            par = _ref[_i];
            _results.push(", " + par);
          }
          return _results;
        }).call(this)).join(''));
      }
    },
    /* @property arrayDeps of define [], eg "['require', 'lodash', 'PersonModel']"*/

    arrayDependenciesPrint: {
      get: function() {
        var dep;
        return "" + (_.isEmpty(this.ti.arrayDeps) ? "" : this.ti.moduleType === 'nodejs' ? "['require', 'exports', 'module'" : "['require'") + (((function() {
          var _i, _len, _ref, _results;
          _ref = this.ti.arrayDeps;
          _results = [];
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            dep = _ref[_i];
            _results.push(", '" + dep + "'");
          }
          return _results;
        }).call(this)).join('')) + (_.isEmpty(this.ti.arrayDeps) ? '' : '], ');
      }
    },
    bodyStart: {
      get: function() {
        return "// uRequire: start body of original " + this.ti.moduleType + " module";
      }
    },
    bodyEnd: {
      get: function() {
        return "// uRequire: end body of original " + this.ti.moduleType + " module";
      }
    },
    factoryBodyPrint: {
      get: function() {
        return "" + this.bodyStart + "\n" + this.ti.factoryBody + "\n" + this.bodyEnd + "\n\n" + (this.ti.moduleType === 'nodejs' ? '\nreturn module.exports;' : '');
      }
    }
  });

  /* private*/


  ModuleGeneratorTemplates.prototype._rootExportsNoConflict = function(factoryFn, rootName) {
    var exp, exportedVar, i;
    if (rootName == null) {
      rootName = 'root';
    }
    return ("var m = " + factoryFn + ";\n" + (this.ti.noConflict ? ((function() {
      var _i, _len, _ref, _results;
      _ref = this.ti.rootExports;
      _results = [];
      for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {
        exp = _ref[i];
        _results.push("" + (i === 0 ? 'var ' : '    ') + "old_" + exp + " = " + rootName + "." + exp);
      }
      return _results;
    }).call(this)).join(',\n') + ';' : '') + "\n\n" + (((function() {
      var _i, _len, _ref, _results;
      _ref = this.ti.rootExports;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        exportedVar = _ref[_i];
        _results.push("" + rootName + "." + exportedVar + " = m");
      }
      return _results;
    }).call(this)).join(';\n')) + ";\n") + (this.ti.noConflict ? "m.noConflict = " + this._function("" + (((function() {
      var _i, _len, _ref, _results;
      _ref = this.ti.rootExports;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        exp = _ref[_i];
        _results.push("  " + rootName + "." + exp + " = old_" + exp);
      }
      return _results;
    }).call(this)).join(';\n')) + ";\nreturn m;") : '') + "\nreturn m;";
  };

  /*
    UMD template - runs AS-IS on both Web/AMD and nodejs (having 'npm install urequire').
    * Uses `NodeRequirer` to perform `require`s.
  */


  ModuleGeneratorTemplates.prototype.UMD = function() {
    var nDep;
    return this.header + this._functionIFI(this.runTimeDiscovery + this._functionIFI("if (typeof exports === 'object') {\n   var nr = new (require('urequire').NodeRequirer) ('" + this.ti.modulePath + "', module, __dirname, '" + this.ti.webRootMap + "');\n   module.exports = factory(nr.require" + (this.ti.moduleType === 'nodejs' ? ', exports, module' : '') + (((function() {
      var _i, _len, _ref, _results;
      _ref = this.ti.nodeDeps;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        nDep = _ref[_i];
        _results.push(", nr.require('" + nDep + "')");
      }
      return _results;
    }).call(this)).join('')) + ");\n } else if (typeof define === 'function' && define.amd) {\n     define(" + this.moduleNamePrint + this.arrayDependenciesPrint + ((_.isEmpty(this.ti.rootExports)) || this.ti.noRootExports ? 'factory' : this._function(this._rootExportsNoConflict("factory(" + this.parametersPrint + ")"), this.parametersPrint)) + ");\n }", 'root', 'this', 'factory', this._function(this.factoryBodyPrint, this.parametersPrint))) + ';';
  };

  /* AMD template
      Simple `define(['dep'], function(dep){...body...}})`
      Runs only on WEB/AMD/RequireJs (and hopefully soon in node through uRequire'd *driven* RequireJS).
  */


  ModuleGeneratorTemplates.prototype.AMD = function() {
    return this.header + this._functionIFI(this.runTimeDiscovery + this._AMD_plain_define());
  };

  ModuleGeneratorTemplates.prototype._AMD_plain_define = function() {
    return "define(" + this.moduleNamePrint + this.arrayDependenciesPrint + "\n  " + (this._function((_.isEmpty(this.ti.rootExports)) || this.ti.noRootExports ? this.factoryBodyPrint : this._rootExportsNoConflict(this._functionIFI(this.factoryBodyPrint, this.parametersPrint, this.parametersPrint), 'window'), this.parametersPrint)) + "\n);";
  };

  ModuleGeneratorTemplates.prototype.combined = function() {
    return this._functionIFI(this._AMD_plain_define(), 'window', '__global');
  };

  ModuleGeneratorTemplates.prototype.nodejs = function() {
    var param, pi;
    return "" + this.header + (this.ti.parameters.length > 0 ? "\nvar " : '') + (((function() {
      var _i, _len, _ref, _results;
      _ref = this.ti.parameters;
      _results = [];
      for (pi = _i = 0, _len = _ref.length; _i < _len; pi = ++_i) {
        param = _ref[pi];
        _results.push("" + (pi === 0 ? '' : '    ') + param + " = require('" + this.ti.nodeDeps[pi] + "')");
      }
      return _results;
    }).call(this)).join(',\n')) + ";\n\n" + this.runTimeDiscovery + "\n\n" + this.bodyStart + "\n" + (this.ti.moduleType === 'AMD' ? "module.exports = " + (this._functionIFI(this.ti.factoryBody)) + ";" : this.ti.factoryBody) + "\n" + this.bodyEnd;
  };

  return ModuleGeneratorTemplates;

}).call(this, Template);

/* Debug information*/

